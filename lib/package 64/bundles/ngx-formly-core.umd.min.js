!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/core"),require("@angular/platform-browser"),require("rxjs/operators"),require("@angular/forms"),require("rxjs")):"function"==typeof define&&define.amd?define("@ngx-formly/core",["exports","@angular/common","@angular/core","@angular/platform-browser","rxjs/operators","@angular/forms","rxjs"],t):t((e["ngx-formly"]=e["ngx-formly"]||{},e["ngx-formly"].core={}),e.ng.common,e.ng.core,e.ng.platformBrowser,e.rxjs.operators,e.ng.forms,e.rxjs)}(this,function(e,r,s,t,p,f,u){"use strict";var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function n(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var c=function(){return(c=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function d(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(r[o[n]]=e[o[n]])}return r}function h(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,n,i=r.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)s.push(o.value)}catch(a){n={error:a}}finally{try{o&&!o.done&&(r=i["return"])&&r.call(i)}finally{if(n)throw n.error}}return s}function m(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(h(arguments[t]));return e}function y(e){if(!e.key)return[];if(!e._keyPath||e._keyPath.key!==e.key){var t=[];if("string"==typeof e.key){var r=-1===e.key.indexOf("[")?e.key:e.key.replace(/\[(\w+)\]/g,".$1");t=-1!==r.indexOf(".")?r.split("."):[r]}else t=Array.isArray(e.key)?e.key.slice(0):[""+e.key];e._keyPath={key:e.key,path:t}}return e._keyPath.path.slice(0)}var a=["required","pattern","minLength","maxLength","min","max"];function i(e,t){var r=y(e);if(0!==r.length){for(var o=e;o.parent;)r=m(y(o=o.parent),r);if(t===undefined&&e.resetOnHide){var n=r.pop();delete r.reduce(function(e,t){return e[t]||{}},o.model)[n]}else!function i(e,t,r){for(var o=0;o<t.length-1;o++){var n=t[o];e[n]&&O(e[n])||(e[n]=/^\d+$/.test(t[o+1])?[]:{}),e=e[n]}e[t[t.length-1]]=_(r)}(o.model,r,t)}}function g(e){var t,r,o=e.parent.model;try{for(var n=function a(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}(y(e)),i=n.next();!i.done;i=n.next()){var s=i.value;if(!o)return o;o=o[s]}}catch(l){t={error:l}}finally{try{i&&!i.done&&(r=n["return"])&&r.call(n)}finally{if(t)throw t.error}}return o}function l(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return e.forEach(function(e){for(var t in e)v(n[t])||""===n[t]?n[t]=_(e[t]):(r=n[t],o=e[t],O(r)&&O(o)&&Object.getPrototypeOf(r)===Object.getPrototypeOf(o)&&!Array.isArray(r)&&!Array.isArray(o)&&l(n[t],e[t]));var r,o}),n}function v(e){return e===undefined||null===e}function b(e){return e===undefined}function C(e){return"function"==typeof e}function O(e){return null!=e&&"object"==typeof e}function _(o){if(!O(o)||u.isObservable(o)||o instanceof s.TemplateRef||o.changingThisBreaksApplicationSecurity||-1!==["RegExp","FileList","File","Blob"].indexOf(o.constructor.name))return o;if(o instanceof Set)return new Set(o);if(o instanceof Map)return new Map(o);if(o._isAMomentObject&&C(o.clone))return o.clone();if(o instanceof f.AbstractControl)return null;if(o instanceof Date)return new Date(o.getTime());if(Array.isArray(o))return o.slice(0).map(function(e){return _(e)});var e=Object.getPrototypeOf(o),t=Object.create(e);return t=Object.setPrototypeOf(t,e),Object.keys(o).reduce(function(e,t){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?Object.defineProperty(e,t,r):e[t]=_(o[t]),e},t)}function F(e,t,r){Object.defineProperty(e,t,{enumerable:!1,writable:!0,configurable:!0}),e[t]=r}function x(e,o,t){e._observers||F(e,"_observers",{}),e._observers[o]||(e._observers[o]=[]);var n=e._observers[o];return-1===n.indexOf(t)&&(n.push(t),t({currentValue:e[o],firstChange:!0}),1===n.length&&(F(e,"___$"+o,e[o]),Object.defineProperty(e,o,{configurable:!0,get:function(){return e["___$"+o]},set:function(t){if(t!==e["___$"+o]){var r=e["___$"+o];e["___$"+o]=t,n.forEach(function(e){return e({previousValue:r,currentValue:t,firstChange:!1})})}}}))),function(){return n.splice(n.indexOf(t),1)}}var E=new s.InjectionToken("FORMLY_CONFIG"),k=function(){function e(){this.types={},this.validators={},this.wrappers={},this.messages={},this.templateManipulators={preWrapper:[],postWrapper:[]},this.extras={checkExpressionOn:"changeDetectionCheck",lazyRender:!1,showError:function(e){return e.formControl&&e.formControl.invalid&&(e.formControl.touched||e.options.parentForm&&e.options.parentForm.submitted||!(!e.field.validation||!e.field.validation.show))}},this.extensions={}}return e.prototype.addConfig=function(e){var t=this;e.types&&e.types.forEach(function(e){return t.setType(e)}),e.validators&&e.validators.forEach(function(e){return t.setValidator(e)}),e.wrappers&&e.wrappers.forEach(function(e){return t.setWrapper(e)}),e.manipulators&&(console.warn("NgxFormly: passing 'manipulators' config is deprecated, use custom extension instead."),e.manipulators.forEach(function(e){return t.setManipulator(e)})),e.validationMessages&&e.validationMessages.forEach(function(e){return t.addValidatorMessage(e.name,e.message)}),e.extensions&&e.extensions.forEach(function(e){return t.extensions[e.name]=e.extension}),e.extras&&(this.extras=c({},this.extras,e.extras))},e.prototype.setType=function(t){var r=this;Array.isArray(t)?t.forEach(function(e){return r.setType(e)}):(this.types[t.name]||(this.types[t.name]={name:t.name}),["component","extends","defaultOptions","wrappers"].forEach(function(e){t.hasOwnProperty(e)&&(r.types[t.name][e]=t[e])}))},e.prototype.getType=function(e){if(!this.types[e])throw new Error('[Formly Error] The type "'+e+'" could not be found. Please make sure that is registered through the FormlyModule declaration.');return this.mergeExtendedType(e),this.types[e]},e.prototype.getMergedField=function(r){var o=this;void 0===r&&(r={});var e=this.getType(r.type);e.defaultOptions&&l(r,e.defaultOptions);var t=e["extends"]&&this.getType(e["extends"]).defaultOptions;t&&l(r,t),r&&r.optionsTypes&&r.optionsTypes.forEach(function(e){var t=o.getType(e).defaultOptions;t&&l(r,t)});var n=this.resolveFieldTypeRef(r);n&&n.instance&&n.instance.defaultOptions&&l(r,n.instance.defaultOptions),!r.wrappers&&e.wrappers&&(r.wrappers=m(e.wrappers))},e.prototype.resolveFieldTypeRef=function(e){if(void 0===e&&(e={}),!e.type)return null;var t=this.getType(e.type);if(!t.component||t._componentRef)return t._componentRef;var r=e.parent.options,o=r._resolver,n=r._injector,i=o.resolveComponentFactory(t.component).create(n);return F(t,"_componentRef",i),i.destroy(),t._componentRef},e.prototype.setWrapper=function(t){var r=this;(this.wrappers[t.name]=t).types&&t.types.forEach(function(e){r.setTypeWrapper(e,t.name)})},e.prototype.getWrapper=function(e){if(!this.wrappers[e])throw new Error('[Formly Error] The wrapper "'+e+'" could not be found. Please make sure that is registered through the FormlyModule declaration.');return this.wrappers[e]},e.prototype.setTypeWrapper=function(e,t){this.types[e]||(this.types[e]={}),this.types[e].wrappers||(this.types[e].wrappers=[]),-1===this.types[e].wrappers.indexOf(t)&&this.types[e].wrappers.push(t)},e.prototype.setValidator=function(e){this.validators[e.name]=e},e.prototype.getValidator=function(e){if(!this.validators[e])throw new Error('[Formly Error] The validator "'+e+'" could not be found. Please make sure that is registered through the FormlyModule declaration.');return this.validators[e]},e.prototype.addValidatorMessage=function(e,t){this.messages[e]=t},e.prototype.getValidatorMessage=function(e){return this.messages[e]},e.prototype.setManipulator=function(e){(new e["class"])[e.method](this)},e.prototype.mergeExtendedType=function(e){if(this.types[e]["extends"]){var t=this.getType(this.types[e]["extends"]);this.types[e].component||(this.types[e].component=t.component),this.types[e].wrappers||(this.types[e].wrappers=t.wrappers)}},e.decorators=[{type:s.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=s.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),P=function(){function e(e,t,r){this.formlyConfig=e,this.componentFactoryResolver=t,this.injector=r}return e.prototype.buildForm=function(e,t,r,o){var n=this;if(void 0===t&&(t=[]),!this.formlyConfig.extensions.core)throw new Error("NgxFormly: missing `forRoot()` call. use `forRoot()` when registering the `FormlyModule`.");var i={fieldGroup:t,model:r,formControl:e,options:this._setOptions(o)};!function s(e,t){var r=e._updateTreeValidity.bind(e);e._updateTreeValidity=function(){},t(),e._updateTreeValidity=r}(e,function(){n._buildForm(i),i.options._checkField(i,!0)})},e.prototype._buildForm=function(t){var r=this;this.getExtensions().forEach(function(e){return e.prePopulate&&e.prePopulate(t)}),this.getExtensions().forEach(function(e){return e.onPopulate&&e.onPopulate(t)}),t.fieldGroup&&t.fieldGroup.forEach(function(e){return r._buildForm(e)}),this.getExtensions().forEach(function(e){return e.postPopulate&&e.postPopulate(t)})},e.prototype.getExtensions=function(){var t=this;return Object.keys(this.formlyConfig.extensions).map(function(e){return t.formlyConfig.extensions[e]})},e.prototype._setOptions=function(t){var r=this;return(t=t||{}).formState=t.formState||{},t.showError||(t.showError=this.formlyConfig.extras.showError),t.fieldChanges||F(t,"fieldChanges",new u.Subject),t._resolver||F(t,"_resolver",this.componentFactoryResolver),t._injector||F(t,"_injector",this.injector),t._hiddenFieldsForCheck||(t._hiddenFieldsForCheck=[]),t._markForCheck||(t._markForCheck=function(e){e._componentRefs&&e._componentRefs.forEach(function(e){e.injector.get(s.ChangeDetectorRef).markForCheck()}),e.fieldGroup&&e.fieldGroup.forEach(function(e){return t._markForCheck(e)})}),t._buildField||(t._buildField=function(e){return r._setOptions(e.options),r._buildForm(e),e.options._checkField(e,!0),e}),t},e.decorators=[{type:s.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:k},{type:s.ComponentFactoryResolver},{type:s.Injector}]},e.ngInjectableDef=s.defineInjectable({factory:function(){return new e(s.inject(k),s.inject(s.ComponentFactoryResolver),s.inject(s.INJECTOR))},token:e,providedIn:"root"}),e}();function w(e,t){void 0===t&&(t=!1);var r=e.formControl,o=r._fields?r._fields.indexOf(e):-1;-1!==o&&r._fields.splice(o,1);var n=r.parent;if(n){var i={emitEvent:t};if(n instanceof f.FormArray){var s=n.controls.findIndex(function(e){return e===r});-1!==s&&A(n,i,function(){return n.removeAt(s)})}else if(n instanceof f.FormGroup){var a=y(e),l=a[a.length-1];n.get([l])===r&&A(n,i,function(){return n.removeControl(l)})}r.setParent(null)}}function V(e){if(e.formControl)return e.formControl;if(!1===e.shareFormControl)return null;var t=e.parent.formControl;return t?t.get(y(e)):null}function j(o,e,r){void 0===r&&(r=!1),(e=e||o.formControl)._fields||F(e,"_fields",[]),-1===e._fields.indexOf(o)&&e._fields.push(o),!o.formControl&&e&&(F(o,"formControl",e),e.setValidators(null),e.setAsyncValidators(null),o.templateOptions.disabled=!!o.templateOptions.disabled,x(o.templateOptions,"disabled",function(e){var t=e.firstChange,r=e.currentValue;t||(r?o.formControl.disable():o.formControl.enable())}),e.registerOnDisabledChange&&e.registerOnDisabledChange(function(e){o.templateOptions.___$disabled=e,o.options&&o.options._markForCheck(o)}));var n=o.parent.formControl;if(n&&o.key){var i=y(o),t=g(o);v(e.value)&&v(t)||e.value===t||!(e instanceof f.FormControl)||e.patchValue(t);for(var s=function(e){var t=i[e];n.get([t])||A(n,{emitEvent:r},function(){return n.setControl(t,new f.FormGroup({}))}),n=n.get([t])},a=0;a<i.length-1;a++)s(a);var l=i[i.length-1];o._hide||n.get([l])===e||A(n,{emitEvent:r},function(){return n.setControl(l,e)})}}function R(e,t){void 0===t&&(t=!1);var r=e.status,o=e.value;e.updateValueAndValidity({emitEvent:!1,onlySelf:t}),r!==e.status&&e.statusChanges.emit(e.status),o!==e.value&&e.valueChanges.emit(e.value)}function A(r,e,t){r instanceof f.FormGroup&&!r.__patchForEachChild&&(F(r,"__patchForEachChild",!0),r._forEachChild=function(t){Object.keys(r.controls).forEach(function(e){return r.controls[e]&&t(r.controls[e],e)})});var o=r.updateValueAndValidity.bind(r);!1===e.emitEvent&&(r.updateValueAndValidity=function(e){o(c({},e||{},{emitEvent:!1}))}),t(),!1===e.emitEvent&&(r.updateValueAndValidity=o)}var M=function(){function e(e,t,r,o,n){var i=this;this.formlyBuilder=e,this.formlyConfig=t,this.ngZone=r,this.parentFormGroup=n,this.modelChange=new s.EventEmitter,this.immutable=!1,this._modelChangeValue={},this.modelChangeSubs=[],this.modelChange$=new u.Subject,this.modelChangeSub=this.modelChange$.pipe(p.switchMap(function(){return i.ngZone.onStable.asObservable().pipe(p.take(1))})).subscribe(function(){return i.ngZone.runGuarded(function(){i.checkExpressionChange(),i.modelChange.emit(i._modelChangeValue=_(i.model))})}),null!==o&&console.warn("NgxFormly: passing 'immutable' attribute to 'formly-form' component is deprecated since v5.5, enable immutable mode through NgModule declaration instead."),this.immutable=null!==o||!!t.extras.immutable}return Object.defineProperty(e.prototype,"model",{get:function(){return this._model||(this._model={}),this._model},set:function(e){this._model=this.immutable?_(e):e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fields",{get:function(){return this._fields||[]},set:function(e){this._fields=this.immutable?_(e):e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},set:function(e){this._options=this.immutable?_(e):e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"content",{set:function(e){if(e){for(var t=!1,r=e.nativeElement.nextSibling;r&&!t;)(r.nodeType===Node.ELEMENT_NODE||r.nodeType===Node.TEXT_NODE&&r.textContent&&""!==r.textContent.trim())&&(t=!0),r=r.nextSibling;t&&console.warn("NgxFormly: content projection for 'formly-form' component is deprecated since v5.5, you should avoid passing content inside the 'formly-form' tag.")}},enumerable:!0,configurable:!0}),e.prototype.ngDoCheck=function(){"changeDetectionCheck"===this.formlyConfig.extras.checkExpressionOn&&this.checkExpressionChange()},e.prototype.ngOnChanges=function(e){e.model&&this.field&&(this.field.model=this.model),e.fields&&this.form&&function r(t){t._fields&&delete t._fields,t.setValidators(null),t.setAsyncValidators(null),(t instanceof f.FormGroup||t instanceof f.FormArray)&&Object.keys(t.controls).forEach(function(e){return r(t.controls[e])})}(this.form),(e.fields||e.form||e.model&&this._modelChangeValue!==e.model.currentValue)&&(this.form=this.form||new f.FormGroup({}),this.setOptions(),this.options.updateInitialValue(),this.clearModelSubscriptions(),this.formlyBuilder.buildForm(this.form,this.fields,this.model,this.options),this.trackModelChanges(this.fields))},e.prototype.ngOnDestroy=function(){this.modelChangeSub.unsubscribe(),this.clearModelSubscriptions()},e.prototype.changeModel=function(e){e.key;var t=e.value;i(e.field,t),this.modelChange$.next()},e.prototype.setOptions=function(){var t=this;this.options||(this.options={}),this.options.resetModel||(this.options.resetModel=function(e){e=_(v(e)?t.options._initialModel:e),t.model&&(Object.keys(t.model).forEach(function(e){return delete t.model[e]}),Object.assign(t.model,e||{})),t.options._buildForm(),t.options.parentForm&&t.options.parentForm.control===t.form?t.options.parentForm.resetForm(t.model):t.form.reset(t.model)}),!this.options.parentForm&&this.parentFormGroup&&(F(this.options,"parentForm",this.parentFormGroup),x(this.options.parentForm,"submitted",function(e){e.firstChange||(t.checkExpressionChange(),t.options._markForCheck({fieldGroup:t.fields,model:t.model,formControl:t.form,options:t.options}))})),this.options.updateInitialValue||(this.options.updateInitialValue=function(){return t.options._initialModel=_(t.model)}),this.options._buildForm||(this.options._buildForm=function(e){void 0===e&&(e=!1),t.clearModelSubscriptions(),t.formlyBuilder.buildForm(t.form,t.fields,t.model,t.options),t.trackModelChanges(t.fields),e&&t.modelChange.emit(t._modelChangeValue=_(t.model))}),this.options._trackModelChanges||(this.options._trackModelChanges=function(e){void 0===e&&(e=!1),t.clearModelSubscriptions(),t.trackModelChanges(t.fields),e&&t.modelChange.emit(t._modelChangeValue=_(t.model))})},e.prototype.checkExpressionChange=function(){this.options&&this.options._checkField&&this.options._checkField({fieldGroup:this.fields,model:this.model,formControl:this.form,options:this.options})},e.prototype.trackModelChanges=function(e,a){var l=this;void 0===a&&(a=[]),e.forEach(function(e){if(e.key&&!e.fieldGroup&&e.formControl){var r=e.formControl,t=r.valueChanges.pipe(p.distinctUntilChanged(function(e,t){return e===t&&!Array.isArray(e)&&!O(e)})),o=e.modelOptions,n=o.updateOn,i=o.debounce;(!n||"change"===n)&&i&&0<i["default"]&&(t=r.valueChanges.pipe(p.debounceTime(i["default"]))),l.modelChangeSubs.push(t.subscribe(function(t){r instanceof f.FormControl&&r._fields&&1<r._fields.length&&r.patchValue(t,{emitEvent:!1,onlySelf:!0}),e.parsers&&0<e.parsers.length&&e.parsers.forEach(function(e){return t=e(t)}),l.changeModel({key:m(a,y(e)).join("."),value:t,field:e})}));var s=r.valueChanges.observers;s&&1<s.length&&s.unshift(s.pop())}e.fieldGroup&&0<e.fieldGroup.length&&l.trackModelChanges(e.fieldGroup,e.key?m(a,y(e)):a)})},e.prototype.clearModelSubscriptions=function(){this.modelChangeSubs.forEach(function(e){return e.unsubscribe()}),this.modelChangeSubs=[]},Object.defineProperty(e.prototype,"field",{get:function(){return this.fields&&this.fields[0]&&this.fields[0].parent},enumerable:!0,configurable:!0}),e.decorators=[{type:s.Component,args:[{selector:"formly-form",template:'\n    <formly-field *ngFor="let field of fields"\n      hide-deprecation\n      [form]="field.form"\n      [options]="field.options"\n      [model]="field.model"\n      [field]="field">\n    </formly-field>\n    <ng-container #content>\n      <ng-content></ng-content>\n    </ng-container>\n  ',providers:[P]}]}],e.ctorParameters=function(){return[{type:P},{type:k},{type:s.NgZone},{type:undefined,decorators:[{type:s.Attribute,args:["immutable"]}]},{type:f.FormGroupDirective,decorators:[{type:s.Optional}]}]},e.propDecorators={form:[{type:s.Input}],model:[{type:s.Input}],fields:[{type:s.Input}],options:[{type:s.Input}],modelChange:[{type:s.Output}],content:[{type:s.ViewChild,args:["content"]}]},e}(),G=function(){function e(e,t,r,o,n){this.formlyConfig=e,this.renderer=t,this.resolver=r,this.elementRef=o,this.warnDeprecation=!1,this.modelChange=new s.EventEmitter,this.hostObservers=[],this.componentRefs=[],this.hooksObservers=[],this.detectFieldBuild=!1,this.warnDeprecation=null===n}return Object.defineProperty(e.prototype,"model",{set:function(e){this.warnDeprecation&&console.warn("NgxFormly: passing 'model' input to '"+this.constructor.name+"' component is not required anymore, you may remove it!")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"form",{set:function(e){this.warnDeprecation&&console.warn("NgxFormly: passing 'form' input to '"+this.constructor.name+"' component is not required anymore, you may remove it!")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{set:function(e){this.warnDeprecation&&console.warn("NgxFormly: passing 'options' input to '"+this.constructor.name+"' component is not required anymore, you may remove it!")},enumerable:!0,configurable:!0}),e.prototype.ngAfterContentInit=function(){this.triggerHook("afterContentInit")},e.prototype.ngAfterContentChecked=function(){this.triggerHook("afterContentChecked")},e.prototype.ngAfterViewInit=function(){this.triggerHook("afterViewInit")},e.prototype.ngAfterViewChecked=function(){this.triggerHook("afterViewChecked")},e.prototype.ngDoCheck=function(){this.triggerHook("doCheck"),this.detectFieldBuild&&this.field&&this.field.options&&this.render()},e.prototype.ngOnInit=function(){this.triggerHook("onInit")},e.prototype.ngOnChanges=function(e){this.triggerHook("onChanges",e)},e.prototype.ngOnDestroy=function(){this.resetRefs(this.field),this.hostObservers.forEach(function(e){return e()}),this.hooksObservers.forEach(function(e){return e()}),this.triggerHook("onDestroy")},e.prototype.renderField=function(e,i,t){var s=this;if(void 0===t&&(t=[]),this.containerRef===e&&(this.resetRefs(this.field),this.containerRef.clear(),t=this.field?this.field.wrappers:[]),t&&0<t.length){var r=h(t),o=r[0],a=r.slice(1),n=this.formlyConfig.getWrapper(o).component,l=e.createComponent(this.resolver.resolveComponentFactory(n));this.attachComponentRef(l,i),x(l.instance,"fieldComponent",function(e){var t=e.firstChange,r=e.previousValue,o=e.currentValue;if(o){if(r&&r._lContainer===o._lContainer)return;var n=r?r.detach():null;n&&!n.destroyed?o.insert(n):s.renderField(o,i,a),!t&&l.changeDetectorRef.detectChanges()}})}else if(i&&i.type){n=this.formlyConfig.getType(i.type).component;var p=e.createComponent(this.resolver.resolveComponentFactory(n));this.attachComponentRef(p,i)}},e.prototype.triggerHook=function(e,t){if(this.field&&this.field.hooks&&this.field.hooks[e]&&(!t||t.field)){var r=this.field.hooks[e](this.field);if(u.isObservable(r)&&-1!==["onInit","afterContentInit","afterViewInit"].indexOf(e)){var o=r.subscribe();this.hooksObservers.push(function(){return o.unsubscribe()})}}this.field&&this.field.lifecycle&&this.field.lifecycle[e]&&this.field.lifecycle[e](this.field.form,this.field,this.field.model,this.field.options),"onChanges"===e&&t.field&&(this.resetRefs(t.field.previousValue),this.render())},e.prototype.attachComponentRef=function(e,t){this.componentRefs.push(e),t._componentRefs.push(e),Object.assign(e.instance,{field:t})},e.prototype.render=function(){var o=this;this.field&&(this.field.options?(this.detectFieldBuild=!1,this.hostObservers.forEach(function(e){return e()}),this.hostObservers=[x(this.field,"hide",function(e){var t=e.firstChange,r=e.currentValue;(!t||t&&r)&&o.renderer.setStyle(o.elementRef.nativeElement,"display",r?"none":""),o.formlyConfig.extras.lazyRender?r?(o.containerRef.clear(),o.field.className&&o.renderer.removeAttribute(o.elementRef.nativeElement,"class")):(o.renderField(o.containerRef,o.field),o.field.className&&o.renderer.setAttribute(o.elementRef.nativeElement,"class",o.field.className)):t&&o.renderField(o.containerRef,o.field)}),x(this.field,"className",function(e){var t=e.firstChange,r=e.currentValue;!(!t||t&&r)||o.formlyConfig.extras.lazyRender&&!0===o.field.hide||o.renderer.setAttribute(o.elementRef.nativeElement,"class",r)})]):this.detectFieldBuild=!0)},e.prototype.resetRefs=function(e){var t=this;e&&(e._componentRefs?e._componentRefs=e._componentRefs.filter(function(e){return-1===t.componentRefs.indexOf(e)}):F(this.field,"_componentRefs",[])),this.componentRefs=[]},e.decorators=[{type:s.Component,args:[{selector:"formly-field",template:"<ng-template #container></ng-template>"}]}],e.ctorParameters=function(){return[{type:k},{type:s.Renderer2},{type:s.ComponentFactoryResolver},{type:s.ElementRef},{type:undefined,decorators:[{type:s.Attribute,args:["hide-deprecation"]}]}]},e.propDecorators={field:[{type:s.Input}],model:[{type:s.Input}],form:[{type:s.Input}],options:[{type:s.Input}],modelChange:[{type:s.Output}],containerRef:[{type:s.ViewChild,args:["container",{read:s.ViewContainerRef,"static":!0}]}]},e}(),I=function(){function e(e,t,r){var o=this;this.renderer=e,this.elementRef=t,this.uiAttributesCache={},this.uiAttributes=null,this.uiEvents={listeners:[],events:["click","keyup","keydown","keypress","focus","blur","change"],callback:function(e,t){switch(e){case"focus":return o.onFocus(t);case"blur":return o.onBlur(t);case"change":return o.onChange(t);default:return o.to[e](o.field,t)}}},this.document=r}return Object.defineProperty(e.prototype,"to",{get:function(){return this.field.templateOptions||{}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fieldAttrElements",{get:function(){return this.field&&this.field._elementRefs||[]},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){var o=this;e.field&&(this.field.name&&this.setAttribute("name",this.field.name),this.uiEvents.listeners.forEach(function(e){return e()}),this.uiEvents.events.forEach(function(t){(o.to&&o.to[t]||-1!==["focus","blur","change"].indexOf(t))&&o.uiEvents.listeners.push(o.renderer.listen(o.elementRef.nativeElement,t,function(e){return o.uiEvents.callback(t,e)}))}),this.to&&this.to.attributes&&x(this.to,"attributes",function(e){var t=e.currentValue,r=e.previousValue;r&&Object.keys(r).forEach(function(e){return o.removeAttribute(e)}),t&&Object.keys(t).forEach(function(e){null!=t[e]&&o.setAttribute(e,t[e])})}),this.detachElementRef(e.field.previousValue),this.attachElementRef(e.field.currentValue),1===this.fieldAttrElements.length&&(!this.id&&this.field.id&&this.setAttribute("id",this.field.id),x(this.field,"focus",function(e){var t=e.currentValue;o.toggleFocus(t)}))),e.id&&this.setAttribute("id",this.id)},e.prototype.ngDoCheck=function(){var r=this;if(!this.uiAttributes){var t=this.elementRef.nativeElement;this.uiAttributes=m(a,["tabindex","placeholder","readonly","disabled","step"]).filter(function(e){return!t.hasAttribute||!t.hasAttribute(e)})}this.uiAttributes.forEach(function(e){var t=r.to[e];r.uiAttributesCache[e]===t||r.to.attributes&&r.to.attributes.hasOwnProperty(e.toLowerCase())||((r.uiAttributesCache[e]=t)||0===t?r.setAttribute(e,!0===t?e:""+t):r.removeAttribute(e))})},e.prototype.ngOnDestroy=function(){this.uiEvents.listeners.forEach(function(e){return e()}),this.detachElementRef(this.field)},e.prototype.toggleFocus=function(e){var r=this,t=this.fieldAttrElements?this.fieldAttrElements[0]:null;if(t&&t.nativeElement.focus){var o=!!this.document.activeElement&&this.fieldAttrElements.some(function(e){var t=e.nativeElement;return r.document.activeElement===t||t.contains(r.document.activeElement)});e&&!o?Promise.resolve().then(function(){return t.nativeElement.focus()}):!e&&o&&Promise.resolve().then(function(){return t.nativeElement.blur()})}},e.prototype.onFocus=function(e){this.field.___$focus=!0,this.to.focus&&this.to.focus(this.field,e)},e.prototype.onBlur=function(e){this.field.___$focus=!1,this.to.blur&&this.to.blur(this.field,e)},e.prototype.onHostChange=function(e){e instanceof Event||this.onChange(e)},e.prototype.onChange=function(e){this.to.change&&this.to.change(this.field,e),this.field.formControl&&this.field.formControl.markAsDirty()},e.prototype.attachElementRef=function(e){e&&(e._elementRefs&&-1===e._elementRefs.indexOf(this.elementRef)?e._elementRefs.push(this.elementRef):F(e,"_elementRefs",[this.elementRef]))},e.prototype.detachElementRef=function(e){var t=e&&e._elementRefs?this.fieldAttrElements.indexOf(this.elementRef):-1;-1!==t&&this.field._elementRefs.splice(t,1)},e.prototype.setAttribute=function(e,t){this.renderer.setAttribute(this.elementRef.nativeElement,e,t)},e.prototype.removeAttribute=function(e){this.renderer.removeAttribute(this.elementRef.nativeElement,e)},e.decorators=[{type:s.Directive,args:[{selector:"[formlyAttributes]",host:{"(change)":"onHostChange($event)"}}]}],e.ctorParameters=function(){return[{type:s.Renderer2},{type:s.ElementRef},{type:undefined,decorators:[{type:s.Inject,args:[r.DOCUMENT]}]}]},e.propDecorators={field:[{type:s.Input,args:["formlyAttributes"]}],id:[{type:s.Input}]},e}(),T=function(){function e(){}return Object.defineProperty(e.prototype,"model",{get:function(){return this.field.model},set:function(e){console.warn("NgxFormly: passing 'model' input to '"+this.constructor.name+"' component is not required anymore, you may remove it!")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"form",{get:function(){return this.field.parent.formControl},set:function(e){console.warn("NgxFormly: passing 'form' input to '"+this.constructor.name+"' component is not required anymore, you may remove it!")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.field.options},set:function(e){console.warn("NgxFormly: passing 'options' input to '"+this.constructor.name+"' component is not required anymore, you may remove it!")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.field.key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"formControl",{get:function(){return this.field.formControl},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"to",{get:function(){return this.field.templateOptions||{}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showError",{get:function(){return this.options.showError(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.field.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"formState",{get:function(){return this.options.formState||{}},enumerable:!0,configurable:!0}),e.propDecorators={field:[{type:s.Input}],model:[{type:s.Input}],form:[{type:s.Input}],options:[{type:s.Input}]},e}(),D=function(t){function e(){var e=t.call(this)||this;return console.warn("NgxFormly: 'Field' has been renamed to 'FieldType', extend 'FieldType' instead."),e}return n(e,t),e}(T),N=function(r){function e(e){var t=r.call(this)||this;return t.defaultOptions={defaultValue:[]},e instanceof P&&console.warn("NgxFormly: passing 'FormlyFormBuilder' to '"+t.constructor.name+"' type is not required anymore, you may remove it!"),t}return n(e,r),Object.defineProperty(e.prototype,"formControl",{get:function(){return this.field.formControl},enumerable:!0,configurable:!0}),e.prototype.onPopulate=function(e){if(!e.formControl&&e.key){var t=V(e);j(e,t||new f.FormArray([],{updateOn:e.modelOptions.updateOn}))}e.fieldGroup=e.fieldGroup||[];var r=e.model?e.model.length:0;if(e.fieldGroup.length>r)for(var o=e.fieldGroup.length-1;r<=o;--o)w(e.fieldGroup[o],!0),e.fieldGroup.splice(o,1);for(o=e.fieldGroup.length;o<r;o++){var n=c({},_(e.fieldArray),{key:""+o});e.fieldGroup.push(n)}},e.prototype.add=function(e,t,r){var o=(void 0===r?{markAsDirty:!0}:r).markAsDirty;e=v(e)?this.field.fieldGroup.length:e,this.model||i(this.field,[]),this.model.splice(e,0,t?_(t):undefined),this._build(),o&&this.formControl.markAsDirty()},e.prototype.remove=function(e,t){var r=(void 0===t?{markAsDirty:!0}:t).markAsDirty;this.model.splice(e,1),w(this.field.fieldGroup[e],!0),this.field.fieldGroup.splice(e,1),this.field.fieldGroup.forEach(function(e,t){return e.key=""+t}),this._build(),r&&this.formControl.markAsDirty()},e.prototype._build=function(){this.options._buildField(this.field),this.options._trackModelChanges(!0)},e.decorators=[{type:s.Directive,args:[{selector:"[ɵfieldArray]"}]}],e.ctorParameters=function(){return[{type:P,decorators:[{type:s.Inject,args:[E]},{type:s.Optional}]}]},e}(T),S=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.propDecorators={fieldComponent:[{type:s.ViewChild,args:["fieldComponent",{read:s.ViewContainerRef,"static":!1}]}]},t}(T),H=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.defaultOptions={defaultValue:{}},e}return n(e,t),e.decorators=[{type:s.Component,args:[{selector:"formly-group",template:'\n    <formly-field *ngFor="let f of field.fieldGroup" [field]="f"></formly-field>\n    <ng-content></ng-content>\n  ',host:{"[class]":'field.fieldGroupClassName || ""'}}]}],e}(T),W=function(){function e(e){this.formlyConfig=e}return e.prototype.ngOnChanges=function(){var n=this,i=a.map(function(e){return"templateOptions."+e});this.errorMessage$=u.merge(this.field.formControl.statusChanges,this.field.options?this.field.options.fieldChanges.pipe(p.filter(function(e){var t=e.field,r=e.type,o=e.property;return t===n.field&&"expressionChanges"===r&&(-1!==o.indexOf("validation")||-1!==i.indexOf(o))})):u.of(null)).pipe(p.startWith(null),p.switchMap(function(){return u.isObservable(n.errorMessage)?n.errorMessage:u.of(n.errorMessage)}))},Object.defineProperty(e.prototype,"errorMessage",{get:function(){var e=this.field.formControl;for(var t in e.errors)if(e.errors.hasOwnProperty(t)){var r=this.formlyConfig.getValidatorMessage(t);if(O(e.errors[t])){if(e.errors[t].errorPath)return;e.errors[t].message&&(r=e.errors[t].message)}return this.field.validation&&this.field.validation.messages&&this.field.validation.messages[t]&&(r=this.field.validation.messages[t]),this.field.validators&&this.field.validators[t]&&this.field.validators[t].message&&(r=this.field.validators[t].message),this.field.asyncValidators&&this.field.asyncValidators[t]&&this.field.asyncValidators[t].message&&(r=this.field.asyncValidators[t].message),"function"==typeof r?r(e.errors[t],this.field):r}},enumerable:!0,configurable:!0}),e.decorators=[{type:s.Component,args:[{selector:"formly-validation-message",template:"{{ errorMessage$ | async }}",changeDetection:s.ChangeDetectionStrategy.OnPush}]}],e.ctorParameters=function(){return[{type:k}]},e.propDecorators={field:[{type:s.Input}]},e}(),q=function(r){function e(e){var t=r.call(this)||this;return t.sanitizer=e,t.innerHtml={content:null,template:null},t}return n(e,r),Object.defineProperty(e.prototype,"template",{get:function(){return this.field&&this.field.template!==this.innerHtml.template&&(this.innerHtml={template:this.field.template,content:this.to.safeHtml?this.sanitizer.bypassSecurityTrustHtml(this.field.template):this.field.template}),this.innerHtml.content},enumerable:!0,configurable:!0}),e.decorators=[{type:s.Component,args:[{selector:"formly-template",template:'<div [innerHtml]="template"></div>'}]}],e.ctorParameters=function(){return[{type:t.DomSanitizer}]},e}(T);function $(e,t,r){return e instanceof Function?e.apply(t,r):!!e}var B=function(){function e(){}return e.prototype.prePopulate=function(e){var r=this;if(!e.parent&&!e.options._checkField){var o=!1;e.options._checkField=function(e,t){o||(o=!0,r.checkField(e,t),o=!1)}}},e.prototype.postPopulate=function(s){var a=this;if(s.parent&&!s._expressionProperties){if(F(s,"_expressionProperties",{}),s.expressionProperties){var e=function(t){var e=s.expressionProperties[t];if("string"==typeof e||C(e))s._expressionProperties[t]={expression:l._evalExpression(t,e,"templateOptions.disabled"===t&&s.parent.expressionProperties&&s.parent.expressionProperties.hasOwnProperty("templateOptions.disabled")?function(){return s.parent.templateOptions.disabled}:undefined)},"templateOptions.disabled"===t&&Object.defineProperty(s._expressionProperties[t],"expressionValue",{get:function(){return s.templateOptions.disabled},set:function(){},enumerable:!0,configurable:!0});else if(e instanceof u.Observable){var r=function(){return e.subscribe(function(e){a.setExprValue(s,t,e),s.options&&s.options._markForCheck&&s.options._markForCheck(s)})},o=r(),n=s.hooks.onInit;s.hooks.onInit=function(){return null===o&&(o=r()),n&&n(s)};var i=s.hooks.onDestroy;s.hooks.onDestroy=function(){i&&i(s),o.unsubscribe(),o=null}}},l=this;for(var t in s.expressionProperties)e(t)}s.hideExpression?(delete s.hide,s.hideExpression=this._evalExpression("hide",s.hideExpression,function(){for(var e=s.parent;e.parent&&!e.hide;)e=e.parent;return e.hide})):x(s,"hide",function(e){var t=e.currentValue,r=e.firstChange;s._hide=t,(!r||r&&!0===t)&&s.options._hiddenFieldsForCheck.push(s)})}},e.prototype._evalExpression=function(n,i,s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return"string"==typeof i&&(i=function o(e,t){try{return-1!==e.indexOf("this.field")&&console.warn("NgxFormly: using 'this.field' in expressionProperties is deprecated since v5.1, use 'field' instead."),Function.apply(void 0,m(t,["return "+e+";"]))}catch(r){console.error(r)}}(i,["model","formState","field"])),"function"!=typeof i&&(i=function(){return!!i}),s&&s()||i.apply(void 0,m(e))}catch(r){throw r.message='[Formly Error] [Expression "'+n+'"] '+r.message,r}}},e.prototype._evalExpressionPath=function(e,t){if(e._expressionProperties[t]&&e._expressionProperties[t].expressionPaths)return e._expressionProperties[t].expressionPaths;var r=[];return-1===t.indexOf("[")?r=t.split("."):t.split(/[[\]]{1,2}/).filter(function(e){return e}).forEach(function(e){var t=e.match(/['|"](.*?)['|"]/);t?r.push(t[1]):r.push.apply(r,m(e.split(".").filter(function(e){return e})))}),e._expressionProperties[t]&&(e._expressionProperties[t].expressionPaths=r),r},e.prototype.checkField=function(e,t){var r=this;void 0===t&&(t=!1);var o=this._checkField(e,t);e.options._hiddenFieldsForCheck.sort(function(e){return e.hide?-1:1}).forEach(function(e){return r.toggleFormControl(e,!!e.hide,!t)}),e.options._hiddenFieldsForCheck=[],o&&(this.checkField(e),e.options&&e.options._markForCheck&&e.options._markForCheck(e))},e.prototype._checkField=function(t,r){var o=this;void 0===r&&(r=!1);var n=!1;return t.fieldGroup.forEach(function(e){e.options&&(o.checkFieldExpressionChange(e,r)&&(n=!0),o.checkFieldVisibilityChange(e,r)&&(t.options._hiddenFieldsForCheck.push(e),n=!0),e.fieldGroup&&0<e.fieldGroup.length&&o._checkField(e,r)&&(n=!0))}),n},e.prototype.checkFieldExpressionChange=function(e,t){if(!e||!e._expressionProperties)return!1;var r=!1,o=e._expressionProperties;for(var n in o){var i=$(o[n].expression,{field:e},[e.model,e.options.formState,e,t]);"templateOptions.disabled"===n&&(i=!!i),(t||o[n].expressionValue!==i&&(!O(i)&&!C(i)||C(i)&&""+o[n].expressionValue!=""+i||u.isObservable(i)||JSON.stringify(i)!==JSON.stringify(o[n].expressionValue)))&&(r=!0,o[n].expressionValue=i,this.setExprValue(e,n,i))}return r},e.prototype.checkFieldVisibilityChange=function(e,t){if(!e||v(e.hideExpression))return!1;var r=!!$(e.hideExpression,{field:e},[e.model,e.options.formState,e,t]),o=!1;return(r!==e.hide||t)&&(o=!0,e.hide=r,e.templateOptions.hidden=r),o},e.prototype.setDisabledState=function(e,t){var r=this;e.fieldGroup&&e.fieldGroup.filter(function(e){return!e.expressionProperties||!e.expressionProperties.hasOwnProperty("templateOptions.disabled")}).forEach(function(e){return r.setDisabledState(e,t)}),e.key&&e.templateOptions.disabled!==t&&(e.templateOptions.disabled=t)},e.prototype.toggleFormControl=function(e,t,r){var o=this;if(e.fieldGroup&&e.fieldGroup.filter(function(e){return!e.hideExpression}).forEach(function(e){return o.toggleFormControl(e,t,r)}),e.formControl&&e.key){F(e,"_hide",!(!t&&!e.hide));var n=e.formControl;n._fields&&1<n._fields.length&&R(n),!0!==t||n._fields&&!n._fields.every(function(e){return!!e._hide})?!1===t&&(e.resetOnHide&&e.parent&&!b(e.defaultValue)&&b(g(e))&&i(e,e.defaultValue),j(e,undefined,!0),e.resetOnHide&&e.fieldArray&&(e.fieldGroup||[]).length!==(e.model||[]).length&&e.options._buildForm(!0)):(w(e,!0),r&&e.resetOnHide&&(e.formControl.reset({value:undefined,disabled:e.formControl.disabled}),e.fieldGroup&&(i(e,undefined),e.formControl instanceof f.FormArray&&(e.fieldGroup.length=0))))}e.options.fieldChanges&&e.options.fieldChanges.next({field:e,type:"hidden",value:t})},e.prototype.setExprValue=function(e,t,r){try{for(var o=e,n=this._evalExpressionPath(e,t),i=n.length-1,s=0;s<i;s++)o=o[n[s]];o[n[i]]=r}catch(p){throw p.message='[Formly Error] [Expression "'+t+'"] '+p.message,p}if("templateOptions.disabled"===t&&e.key&&this.setDisabledState(e,r),0===t.indexOf("model.")){var a=t.replace(/^model\./,""),l=e.key&&t===a?e.formControl:e.parent.formControl.get(a);!l||v(l.value)&&v(r)||l.value===r||l.patchValue(r)}this.emitExpressionChanges(e,t,r)},e.prototype.emitExpressionChanges=function(e,t,r){e.options.fieldChanges&&e.options.fieldChanges.next({field:e,type:"expressionChanges",property:t,value:r})},e}(),L=function(){function e(e){this.formlyConfig=e}return e.prototype.onPopulate=function(e){this.initFieldValidation(e,"validators"),this.initFieldValidation(e,"asyncValidators")},e.prototype.initFieldValidation=function(t,e){var r=this,o=[];if("validators"!==e||t.hasOwnProperty("fieldGroup")&&!t.key||o.push(this.getPredefinedFieldValidation(t)),t[e])for(var n in t[e])"validation"!==n||Array.isArray(t[e].validation)||(t[e].validation=[t[e].validation],console.warn("NgxFormly("+t.key+"): passing a non array value to the 'validation' is deprecated, pass an array instead")),"validation"===n?o.push.apply(o,m(t[e].validation.map(function(e){return r.wrapNgValidatorFn(t,e)}))):o.push(this.wrapNgValidatorFn(t,t[e][n],n));F(t,"_"+e,o)},e.prototype.getPredefinedFieldValidation=function(n){var i=[];return a.forEach(function(o){return x(n.templateOptions,o,function(e){var t=e.currentValue,r=e.firstChange;i=i.filter(function(e){return e!==o}),null!=t&&!1!==t&&i.push(o),!r&&n.formControl&&R(n.formControl)})}),function(r){return 0===i.length?null:f.Validators.compose(i.map(function(t){return function(){var e=n.templateOptions[t];switch(t){case"required":return f.Validators.required(r);case"pattern":return f.Validators.pattern(e)(r);case"minLength":return f.Validators.minLength(e)(r);case"maxLength":return f.Validators.maxLength(e)(r);case"min":return f.Validators.min(e)(r);case"max":return f.Validators.max(e)(r)}}}))(r)}},e.prototype.wrapNgValidatorFn=function(o,e,n){var i=this,s=null;if("string"==typeof e&&(s=_(this.formlyConfig.getValidator(e))),"object"==typeof e&&e.name&&(s=_(this.formlyConfig.getValidator(e.name)),e.options&&(s.options=e.options)),"object"==typeof e&&e.expression){var t=e.expression,r=d(e,["expression"]);s={name:n,validation:t,options:0<Object.keys(r).length?r:null}}return"function"==typeof e&&(s={name:n,validation:e}),function(e){var t=s.validation(e,o,s.options);return function r(e){return!!e&&"function"==typeof e.then}(t)?t.then(function(e){return i.handleAsyncResult(o,n?!!e:e,s)}):u.isObservable(t)?t.pipe(p.map(function(e){return i.handleAsyncResult(o,n?!!e:e,s)})):i.handleResult(o,n?!!t:t,s)}},e.prototype.handleAsyncResult=function(e,t,r){return e.options&&e.options._markForCheck&&e.options._markForCheck(e),this.handleResult(e,t,r)},e.prototype.handleResult=function(s,a,e){var t,r=e.name,l=e.options;"boolean"==typeof a&&(a=a?null:((t={})[r]=l||!0,t));var p=s.formControl;return p._childrenErrors&&p._childrenErrors[r]&&p._childrenErrors[r](),O(a)&&Object.keys(a).forEach(function(o){var e,t=a[o].errorPath?a[o].errorPath:(l||{}).errorPath,n=t?s.formControl.get(t):null;if(n){var r=a[o],i=(r.errorPath,d(r,["errorPath"]));n.setErrors(c({},n.errors||{},((e={})[o]=i,e))),!p._childrenErrors&&F(p,"_childrenErrors",{}),p._childrenErrors[o]=function(){var e=n.errors||{},t=o,r=(e[t],d(e,["symbol"==typeof t?t:t+""]));n.setErrors(0===Object.keys(r).length?null:r)}}}),a},e}(),z=function(){function e(e){this.config=e}return e.prototype.prePopulate=function(e){this.root||(this.root=e)},e.prototype.onPopulate=function(e){e.parent&&(e.fieldGroup&&!e.key?F(e,"formControl",e.parent.formControl):this.addFormControl(e))},e.prototype.postPopulate=function(e){this.root===e&&(this.root=null,this.setValidators(e))},e.prototype.addFormControl=function(e){var t=V(e);if(!t){var r={updateOn:e.modelOptions.updateOn},o=e.key?g(e):e.defaultValue,n=this.config?this.config.resolveFieldTypeRef(e):null;if(n&&n.componentType&&n.componentType.createControl){var i=n.componentType;console.warn("NgxFormly: '"+i.name+"::createControl' is deprecated since v5.0, use 'prePopulate' hook instead."),t=i.createControl(o,e)}else t=e.fieldGroup?new f.FormGroup({},r):new f.FormControl(o,r)}j(e,t)},e.prototype.setValidators=function(t,r){var o=this;void 0===r&&(r=!1);var n=!1;if(!1===r&&t.key&&t.templateOptions&&t.templateOptions.disabled&&(r=!0),(t.fieldGroup||[]).forEach(function(e){return o.setValidators(e,r)&&(n=!0)}),t.key||!t.parent||!t.key&&!t.fieldGroup){var i=t.formControl;t.templateOptions=t.templateOptions||{},t.key&&i&&i instanceof f.FormControl&&(r&&i.enabled&&(i.disable({emitEvent:!1,onlySelf:!0}),n=!0),!r&&i.disabled&&(i.enable({emitEvent:!1,onlySelf:!0}),n=!0)),!i||null!==i.validator&&null!==i.asyncValidator||(i.setValidators(function(){var e=f.Validators.compose(o.mergeValidators(t,"_validators"));return e?e(i):null}),i.setAsyncValidators(function(){var e=f.Validators.composeAsync(o.mergeValidators(t,"_asyncValidators"));return e?e(i):u.of(null)}),n=!0),n&&R(i,!0)}return n},e.prototype.mergeValidators=function(e,t){var r=this,o=[],n=e.formControl;return n&&n._fields&&1<n._fields.length?n._fields.filter(function(e){return!e._hide}).forEach(function(e){return o.push.apply(o,m(e[t]))}):e[t]&&o.push.apply(o,m(e[t])),e.fieldGroup&&e.fieldGroup.filter(function(e){return!e.key&&e.fieldGroup}).forEach(function(e){return o.push.apply(o,m(r.mergeValidators(e,t)))}),o},e}(),Y=function(){function e(e){this.formlyConfig=e,this.formId=0}return e.prototype.prePopulate=function(t){if(this.getFieldComponentInstance(t).prePopulate(),!t.parent){var e=t.options&&t.options.fieldTransform||this.formlyConfig.extras.fieldTransform;(Array.isArray(e)?e:[e]).forEach(function(e){if(e&&(console.warn("NgxFormly: fieldTransform is deprecated since v5.0, use custom extension instead."),!e(t.fieldGroup,t.model,t.formControl,t.options)))throw new Error("fieldTransform must return an array of fields")})}},e.prototype.onPopulate=function(r){var o=this;this.initFieldOptions(r),this.getFieldComponentInstance(r).onPopulate(),r.fieldGroup&&r.fieldGroup.forEach(function(e,t){Object.defineProperty(e,"parent",{get:function(){return r},configurable:!0}),Object.defineProperty(e,"index",{get:function(){return t},configurable:!0}),o.formId++})},e.prototype.postPopulate=function(e){this.getFieldComponentInstance(e).postPopulate()},e.prototype.initFieldOptions=function(e){var t=e.parent;if(t){if(Object.defineProperty(e,"form",{get:function(){return t.formControl},configurable:!0}),Object.defineProperty(e,"options",{get:function(){return t.options},configurable:!0}),Object.defineProperty(e,"model",{get:function(){return e.key&&e.fieldGroup?g(e):t.model},configurable:!0}),l(e,{id:function n(e,t,r){if(t.id)return t.id;var o=t.type;return!o&&t.template&&(o="template"),C(o)&&(o=o.prototype.constructor.name),[e,o,t.key,r].join("_")}("formly_"+this.formId,e,e.index),hooks:{},modelOptions:{},validation:{messages:{}},templateOptions:e.type&&e.key?{label:"",placeholder:"",focus:!1,disabled:!1}:{}}),this.formlyConfig.extras.resetFieldOnHide&&!1!==e.resetOnHide&&(e.resetOnHide=!0),e.lifecycle&&console.warn("NgxFormly: 'lifecycle' is deprecated since v5.0, use 'hooks' instead."),"formly-template"!==e.type&&(e.template||e.expressionProperties&&e.expressionProperties.template)&&(e.type&&console.warn("NgxFormly: passing 'type' property is not allowed when 'template' is set."),e.type="formly-template"),!e.type&&e.fieldGroup&&(e.type="formly-group"),e.type&&this.formlyConfig.getMergedField(e),e.parent){var r=!b(e.key)&&!b(e.defaultValue)&&b(g(e))&&(!e.resetOnHide||!(e.hide||e.hideExpression));if(r&&e.resetOnHide){for(var o=e.parent;o&&!o.hideExpression&&!o.hide;)o=o.parent;r=!o||!(o.hideExpression||o.hide)}r&&i(e,e.defaultValue)}this.initFieldWrappers(e)}},e.prototype.initFieldWrappers=function(t){t.wrappers=t.wrappers||[];var e=c({preWrapper:[],postWrapper:[]},t.templateOptions.templateManipulators||{});t.wrappers=m(this.formlyConfig.templateManipulators.preWrapper.map(function(e){return e(t)}),e.preWrapper.map(function(e){return e(t)}),t.wrappers,this.formlyConfig.templateManipulators.postWrapper.map(function(e){return e(t)}),e.postWrapper.map(function(e){return e(t)})).filter(function(e,t,r){return e&&t===r.indexOf(e)})},e.prototype.getFieldComponentInstance=function(e){var t=this.formlyConfig.resolveFieldTypeRef(e),r=t?t.instance:{};return{prePopulate:function(){return r.prePopulate&&r.prePopulate(e)},onPopulate:function(){return r.onPopulate&&r.onPopulate(e)},postPopulate:function(){return r.postPopulate&&r.postPopulate(e)}}},e}();function Z(e){return{types:[{name:"formly-group",component:H},{name:"formly-template",component:q}],extensions:[{name:"core",extension:new Y(e)},{name:"field-validation",extension:new L(e)},{name:"field-form",extension:new z(e)},{name:"field-expression",extension:new B}]}}var J=function(){function t(t,e){void 0===e&&(e=[]),e&&e.forEach(function(e){return t.addConfig(e)})}return t.forRoot=function(e){return void 0===e&&(e={}),{ngModule:t,providers:[{provide:E,multi:!0,useFactory:Z,deps:[k]},{provide:E,useValue:e,multi:!0},{provide:s.ANALYZE_FOR_ENTRY_COMPONENTS,useValue:e,multi:!0},k,P]}},t.forChild=function(e){return void 0===e&&(e={}),{ngModule:t,providers:[{provide:E,multi:!0,useFactory:Z,deps:[k]},{provide:E,useValue:e,multi:!0},{provide:s.ANALYZE_FOR_ENTRY_COMPONENTS,useValue:e,multi:!0},P]}},t.decorators=[{type:s.NgModule,args:[{declarations:[M,G,I,H,W,q,N],entryComponents:[H,q],exports:[M,G,I,H,W],imports:[r.CommonModule]}]}],t.ctorParameters=function(){return[{type:k},{type:Array,decorators:[{type:s.Optional},{type:s.Inject,args:[E]}]}]},t}();e.FormlyForm=M,e.FormlyField=G,e.FormlyAttributes=I,e.FORMLY_CONFIG=E,e.FormlyConfig=k,e.FormlyFormBuilder=P,e.FieldType=T,e.Field=D,e.FieldArrayType=N,e.FieldWrapper=S,e.FormlyModule=J,e.ɵdefineHiddenProp=F,e.ɵreverseDeepMerge=l,e.ɵgetFieldValue=g,e.ɵclone=_,e.ɵwrapProperty=x,e.ɵa=Z,e.ɵe=Y,e.ɵh=B,e.ɵg=z,e.ɵf=L,e.ɵd=q,e.ɵb=H,e.ɵc=W,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-formly-core.umd.min.js.map